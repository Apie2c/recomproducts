<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dani-Tech - Your Home for Smart Appliances</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Dark background */
            color: #f0f6fc; /* Light text */
        }
        /* Custom scrollbar for better look in dark mode */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #0891b2; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header & Navigation (UPDATED: Added Search Box) -->
    <header class="bg-gray-900 shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-wrap justify-between items-center gap-4">
            <!-- Logo/Site Name -->
            <div class="text-2xl font-bold text-cyan-400">Dani-Tech</div>

            <!-- Search Input - Integrated in the center (MODIFIED: max-w-md and py-1 for smaller size) -->
            <div class="w-full order-3 md:order-none md:w-auto flex-grow max-w-md">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="Search for appliances, brands, or features..." class="w-full px-4 py-1 pl-10 rounded-full border border-gray-700 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition duration-150">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>
            
            <!-- Mobile Menu Button -->
            <button id="menu-button" class="md:hidden p-2 rounded-lg hover:bg-gray-700 transition duration-150 order-2">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex space-x-8 order-4 md:order-none">
                <a href="#featured" class="text-gray-300 hover:text-cyan-400 transition duration-150">Featured</a>
                <a href="#categories" class="text-gray-300 hover:text-cyan-400 transition duration-150">Categories</a>
                <a href="#deals" class="text-gray-300 hover:text-cyan-400 transition duration-150">Deals</a>
                <a href="#" class="px-4 py-2 bg-cyan-600 text-white rounded-full text-sm font-semibold hover:bg-cyan-500 transition duration-150">My Picks</a>
            </nav>
        </div>
        
        <!-- Mobile Navigation Drawer -->
        <nav id="mobile-menu" class="hidden md:hidden bg-gray-800 border-t border-gray-700">
            <a href="#featured" class="block px-4 py-3 text-gray-300 hover:bg-gray-700">Featured</a>
            <a href="#categories" class="block px-4 py-3 text-gray-300 hover:bg-gray-700">Categories</a>
            <a href="#deals" class="block px-4 py-3 text-gray-300 hover:bg-gray-700">Deals</a>
            <a href="#" class="block px-4 py-3 text-white bg-cyan-700 hover:bg-cyan-600">My Picks</a>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- HOME PAGE CONTENT -->
        <div id="home-page" class="space-y-12">
            <!-- Hero Section (Unchanged) -->
            <section class="text-center bg-gray-800 p-8 md:p-16 rounded-3xl shadow-2xl border border-gray-700">
                <h1 class="text-4xl sm:text-6xl font-extrabold mb-4 leading-tight text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-sky-500">
                    The Smartest Tech for Your Home
                </h1>
                <p class="text-lg text-gray-300 mb-8 max-w-2xl mx-auto">
                    Hand-picked, tested, and reviewedâ€”we connect you directly to the best deals on cutting-edge smart appliances.
                </p>
                <a href="#featured" class="inline-block px-8 py-3 text-lg font-bold text-gray-900 bg-cyan-400 rounded-full shadow-lg hover:bg-cyan-300 transform hover:scale-105 transition duration-300 ease-in-out">
                    Explore Top Recommendations
                </a>
            </section>

            <!-- Featured Products Section (Content is now dynamic) -->
            <section id="featured">
                <h2 class="text-3xl font-bold text-white mb-8 border-b-2 border-cyan-500 pb-2">ðŸ”¥ Featured Picks</h2>
                
                <!-- The product cards here will be populated by JavaScript using data loaded from Firestore -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="col-span-full text-center py-8 text-gray-500">Loading featured products...</div>
                </div>
            </section>

            <!-- Categories Section (Content is now dynamic) -->
            <section id="categories">
                <h2 class="text-3xl font-bold text-white mb-8 border-b-2 border-cyan-500 pb-2">Browse By Category</h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="col-span-full text-center py-4 text-gray-500">Loading categories...</div>
                </div>
            </section>

            <!-- CTA Banner (Unchanged) -->
            <section id="deals" class="bg-cyan-900/50 p-8 md:p-10 rounded-2xl text-center border-l-8 border-cyan-400">
                <h2 class="text-3xl font-bold text-white mb-3">Never Miss a Deal</h2>
                <p class="text-gray-300 mb-6 max-w-xl mx-auto">
                    Sign up for our weekly newsletter to get the absolute lowest prices on top-rated tech appliances delivered straight to your inbox.
                </p>
                <form action="#" class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <input type="email" placeholder="Enter your email address" class="px-5 py-3 rounded-full border-2 border-cyan-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-gray-900 text-white placeholder-gray-400 w-full sm:w-80" required>
                    <button type="submit" class="px-8 py-3 bg-cyan-400 text-gray-900 font-bold rounded-full hover:bg-cyan-300 transition duration-150 shadow-xl">
                        Subscribe Now
                    </button>
                </form>
            </section>
        </div>

        <!-- CATEGORY PAGE TEMPLATE (Initially hidden) -->
        <section id="category-page" class="hidden">
            <!-- Breadcrumbs -->
            <div class="text-sm breadcrumbs mb-8 text-gray-500">
                <a href="#" class="hover:text-cyan-400 transition duration-150">Home</a> 
                <span class="mx-2">&gt;</span> 
                <span id="breadcrumb-category" class="text-cyan-400 font-semibold">Category Name</span>
            </div>

            <div class="mb-10 p-6 bg-gray-900 rounded-xl border border-gray-700">
                <h1 id="category-title" class="text-4xl font-bold text-white mb-3">Category Title</h1>
                <p id="category-description" class="text-lg text-gray-400">Category description will go here.</p>
            </div>

            <!-- Products Grid (Dynamically populated) -->
            <div id="category-product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Product cards will be inserted here by JavaScript -->
            </div>
        </section>

        <!-- PRODUCT DETAIL VIEW (NEW) -->
        <section id="product-detail-page" class="hidden">
            <!-- Content will be dynamically populated by renderProductDetailPage -->
        </section>

        <!-- SEARCH RESULTS VIEW (NEW) -->
        <section id="search-results-page" class="hidden">
            <!-- Breadcrumbs -->
            <div class="text-sm breadcrumbs mb-8 text-gray-500">
                <a href="#" class="hover:text-cyan-400 transition duration-150">Home</a> 
                <span class="mx-2">&gt;</span> 
                <span class="text-cyan-400 font-semibold">Search Results for "<span id="search-query-display"></span>"</span>
            </div>
            
            <h1 class="text-4xl font-bold text-white mb-8">Search Results</h1>
            <div id="search-product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Search result cards will be inserted here -->
            </div>
            <p id="no-results" class="hidden text-center py-10 text-xl text-gray-400">No products found matching your query.</p>
        </section>

    </main>

    <!-- Footer (UPDATED with ALL Social Media Icons) -->
    <footer class="mt-12 bg-gray-900 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:flex md:justify-between md:items-center">
            <div class="text-center md:text-left mb-4 md:mb-0">
                <p class="text-gray-400 text-sm">&copy; 2025 Dani-Tech. All rights reserved.</p>
                <p class="text-xs text-gray-500 mt-1">As an affiliate, we may earn commissions from qualifying purchases.</p>
            </div>
            
            <!-- Policy Links and Social Media Icons -->
            <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-8">
                <!-- Policy Links -->
                <div class="flex justify-center space-x-6 text-sm">
                    <a href="#" class="text-gray-400 hover:text-cyan-400 transition duration-150">Privacy Policy</a>
                    <a href="#" class="text-gray-400 hover:text-cyan-400 transition duration-150">Disclosure</a>
                    <a href="#" class="text-gray-400 hover:text-cyan-400 transition duration-150">Contact Us</a>
                </div>
                
                <!-- Social Icons (EXPANDED) -->
                <div class="flex justify-center flex-wrap gap-4 md:space-x-4">
                    <!-- X / Twitter -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Follow us on X" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="24" cy="24" r="20" fill="#1DA1F2"></circle> <path fill-rule="evenodd" clip-rule="evenodd" d="M36 16.3086C35.1177 16.7006 34.1681 16.9646 33.1722 17.0838C34.1889 16.4742 34.9697 15.5095 35.3368 14.36C34.3865 14.9247 33.3314 15.3335 32.2107 15.5551C31.3123 14.5984 30.0316 14 28.6165 14C25.8975 14 23.6928 16.2047 23.6928 18.9237C23.6928 19.3092 23.7368 19.6852 23.8208 20.046C19.7283 19.8412 16.1005 17.8805 13.6719 14.9015C13.2479 15.6287 13.0055 16.4742 13.0055 17.3766C13.0055 19.0845 13.8735 20.5916 15.1958 21.4747C14.3878 21.4491 13.6295 21.2275 12.9647 20.8587V20.9203C12.9647 23.3066 14.663 25.296 16.9141 25.7496C16.5013 25.8616 16.0661 25.9224 15.6174 25.9224C15.2998 25.9224 14.991 25.8912 14.6902 25.8336C15.3166 27.7895 17.1357 29.2134 19.2899 29.2534C17.6052 30.5733 15.4822 31.3612 13.1751 31.3612C12.7767 31.3612 12.3848 31.338 12 31.2916C14.1791 32.6884 16.7669 33.5043 19.5475 33.5043C28.6037 33.5043 33.5562 26.0016 33.5562 19.4956C33.5562 19.282 33.5522 19.0693 33.5418 18.8589C34.5049 18.1629 35.34 17.2958 36 16.3086Z" fill="white"></path> </g></svg>
                    </a>
                    <!-- Facebook -->
                    <a href="https://apie2c.github.io/recomproducts/#https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Follow us on Facebook" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="24" cy="24" r="20" fill="#3B5998"></circle> <path fill-rule="evenodd" clip-rule="evenodd" d="M29.315 16.9578C28.6917 16.8331 27.8498 16.74 27.3204 16.74C25.8867 16.74 25.7936 17.3633 25.7936 18.3607V20.1361H29.3774L29.065 23.8137H25.7936V35H21.3063V23.8137H19V20.1361H21.3063V17.8613C21.3063 14.7453 22.7708 13 26.4477 13C27.7252 13 28.6602 13.187 29.8753 13.4363L29.315 16.9578Z" fill="white"></path> </g></svg>
                    </a>
                    <!-- Instagram -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Follow us on Instagram" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="24" cy="24" r="20" fill="#C13584"></circle> <path d="M24 14.1622C27.2041 14.1622 27.5837 14.1744 28.849 14.2321C30.019 14.2855 30.6544 14.481 31.0773 14.6453C31.6374 14.863 32.0371 15.123 32.457 15.5429C32.877 15.9629 33.137 16.3626 33.3547 16.9227C33.519 17.3456 33.7145 17.981 33.7679 19.1509C33.8256 20.4163 33.8378 20.7958 33.8378 23.9999C33.8378 27.2041 33.8256 27.5836 33.7679 28.849C33.7145 30.019 33.519 30.6543 33.3547 31.0772C33.137 31.6373 32.877 32.0371 32.4571 32.457C32.0371 32.8769 31.6374 33.1369 31.0773 33.3546C30.6544 33.519 30.019 33.7144 28.849 33.7678C27.5839 33.8255 27.2044 33.8378 24 33.8378C20.7956 33.8378 20.4162 33.8255 19.151 33.7678C17.981 33.7144 17.3456 33.519 16.9227 33.3546C16.3626 33.1369 15.9629 32.8769 15.543 32.457C15.1231 32.0371 14.863 31.6373 14.6453 31.0772C14.481 30.6543 14.2855 30.019 14.2321 28.849C14.1744 27.5836 14.1622 27.2041 14.1622 23.9999C14.1622 20.7958 14.1744 20.4163 14.2321 19.1509C14.2855 17.981 14.481 17.3456 14.6453 16.9227C14.863 16.3626 15.123 15.9629 15.543 15.543C15.9629 15.123 16.3626 14.863 16.9227 14.6453C17.3456 14.481 17.981 14.2855 19.151 14.2321C20.4163 14.1744 20.7959 14.1622 24 14.1622ZM24 12C20.741 12 20.3323 12.0138 19.0524 12.0722C17.7752 12.1305 16.9028 12.3333 16.1395 12.63C15.3504 12.9366 14.6812 13.3469 14.0141 14.0141C13.3469 14.6812 12.9366 15.3504 12.63 16.1395C12.3333 16.9028 12.1305 17.7751 12.0722 19.0524C12.0138 20.3323 12 20.741 12 23.9999C12 27.259 12.0138 27.6676 12.0722 28.9475C12.1305 30.2248 12.3333 31.0971 12.63 31.8604C12.9366 32.6495 13.3469 33.3187 14.0141 33.9859C14.6812 34.653 15.3504 35.0633 16.1395 35.3699C16.9028 35.6666 17.7752 35.8694 19.0524 35.9277C20.3323 35.9861 20.741 35.9999 24 35.9999C27.259 35.9999 27.6677 35.9861 28.9476 35.9277C30.2248 35.8694 31.0972 35.6666 31.8605 35.3699C32.6496 35.0633 33.3188 34.653 33.9859 33.9859C34.653 33.3187 35.0634 32.6495 35.37 31.8604C35.6667 31.0971 35.8695 30.2248 35.9278 28.9475C35.9862 27.6676 36 27.259 36 23.9999C36 20.741 35.9862 20.3323 35.9278 19.0524C35.8695 17.7751 35.6667 16.9028 35.37 16.1395C35.0634 15.3504 34.653 14.6812 33.9859 14.0141C33.3188 13.3469 32.6496 12.9366 31.8605 12.63C31.0972 12.3333 30.2248 12.1305 28.9476 12.0722C27.6677 12.0138 27.259 12 24 12Z" fill="white"></path> <path d="M24.0059 17.8433C20.6026 17.8433 17.8438 20.6021 17.8438 24.0054C17.8438 27.4087 20.6026 30.1675 24.0059 30.1675C27.4092 30.1675 30.1681 27.4087 30.1681 24.0054C30.1681 20.6021 27.4092 17.8433 24.0059 17.8433ZM24.0059 28.0054C21.7968 28.0054 20.0059 26.2145 20.0059 24.0054C20.0059 21.7963 21.7968 20.0054 24.0059 20.0054C26.2151 20.0054 28.0059 21.7963 28.0059 24.0054C28.0059 26.2145 26.2151 28.0054 24.0059 28.0054Z" fill="white"></path> <path d="M31.8507 17.5963C31.8507 18.3915 31.206 19.0363 30.4107 19.0363C29.6154 19.0363 28.9707 18.3915 28.9707 17.5963C28.9707 16.801 29.6154 16.1562 30.4107 16.1562C31.206 16.1562 31.8507 16.801 31.8507 17.5963Z" fill="white"></path> </g></svg>
                    </a>
                    
                    <!-- TikTok -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Follow us on TikTok" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M8.45095 19.7926C8.60723 18.4987 9.1379 17.7743 10.1379 17.0317C11.5688 16.0259 13.3561 16.5948 13.3561 16.5948V13.2197C13.7907 13.2085 14.2254 13.2343 14.6551 13.2966V17.6401C14.6551 17.6401 12.8683 17.0712 11.4375 18.0775C10.438 18.8196 9.90623 19.5446 9.7505 20.8385C9.74562 21.5411 9.87747 22.4595 10.4847 23.2536C10.3345 23.1766 10.1815 23.0889 10.0256 22.9905C8.68807 22.0923 8.44444 20.7449 8.45095 19.7926ZM22.0352 6.97898C21.0509 5.90039 20.6786 4.81139 20.5441 4.04639H21.7823C21.7823 4.04639 21.5354 6.05224 23.3347 8.02482L23.3597 8.05134C22.8747 7.7463 22.43 7.38624 22.0352 6.97898ZM28 10.0369V14.293C28 14.293 26.42 14.2312 25.2507 13.9337C23.6179 13.5176 22.5685 12.8795 22.5685 12.8795C22.5685 12.8795 21.8436 12.4245 21.785 12.3928V21.1817C21.785 21.6711 21.651 22.8932 21.2424 23.9125C20.709 25.246 19.8859 26.1212 19.7345 26.3001C19.7345 26.3001 18.7334 27.4832 16.9672 28.28C15.3752 28.9987 13.9774 28.9805 13.5596 28.9987C13.5596 28.9987 11.1434 29.0944 8.96915 27.6814C8.49898 27.3699 8.06011 27.0172 7.6582 26.6277L7.66906 26.6355C9.84383 28.0485 12.2595 27.9528 12.2595 27.9528C12.6779 27.9346 14.0756 27.9528 15.6671 27.2341C17.4317 26.4374 18.4344 25.2543 18.4344 25.2543C18.5842 25.0754 19.4111 24.2001 19.9423 22.8662C20.3498 21.8474 20.4849 20.6247 20.4849 20.1354V11.3475C20.5435 11.3797 21.2679 11.8347 21.2679 11.8347C21.2679 11.8347 22.3179 12.4734 23.9506 12.8889C25.1204 13.1864 26.7 13.2483 26.7 13.2483V9.91314C27.2404 10.0343 27.7011 10.0671 28 10.0369Z" fill="#EE1D52"></path> <path d="M26.7009 9.91314V13.2472C26.7009 13.2472 25.1213 13.1853 23.9515 12.8879C22.3188 12.4718 21.2688 11.8337 21.2688 11.8337C21.2688 11.8337 20.5444 11.3787 20.4858 11.3464V20.1364C20.4858 20.6258 20.3518 21.8484 19.9432 22.8672C19.4098 24.2012 18.5867 25.0764 18.4353 25.2553C18.4353 25.2553 17.4337 26.4384 15.668 27.2352C14.0765 27.9539 12.6788 27.9357 12.2604 27.9539C12.2604 27.9539 9.84473 28.0496 7.66995 26.6366L7.6591 26.6288C7.42949 26.4064 7.21336 26.1717 7.01177 25.9257C6.31777 25.0795 5.89237 24.0789 5.78547 23.7934C5.78529 23.7922 5.78529 23.791 5.78547 23.7898C5.61347 23.2937 5.25209 22.1022 5.30147 20.9482C5.38883 18.9122 6.10507 17.6625 6.29444 17.3494C6.79597 16.4957 7.44828 15.7318 8.22233 15.0919C8.90538 14.5396 9.6796 14.1002 10.5132 13.7917C11.4144 13.4295 12.3794 13.2353 13.3565 13.2197V16.5948C13.3565 16.5948 11.5691 16.028 10.1388 17.0317C9.13879 17.7743 8.60812 18.4987 8.45185 19.7926C8.44534 20.7449 8.68897 22.0923 10.0254 22.991C10.1813 23.0898 10.3343 23.1775 10.4845 23.2541C10.7179 23.5576 11.0021 23.8221 11.3255 24.0368C12.631 24.8632 13.7249 24.9209 15.1238 24.3842C16.0565 24.0254 16.7586 23.2167 17.0842 22.3206C17.2888 21.7611 17.2861 21.1978 17.2861 20.6154V4.04639H20.5417C20.6763 4.81139 21.0485 5.90039 22.0328 6.97898C22.4276 7.38624 22.8724 7.7463 23.3573 8.05134C23.5006 8.19955 24.2331 8.93231 25.1734 9.38216C25.6596 9.61469 26.1722 9.79285 26.7009 9.91314Z" fill="#000000"></path> <path d="M4.48926 22.7568V22.7594L4.57004 22.9784C4.56076 22.9529 4.53074 22.8754 4.48926 22.7568Z" fill="#69C9D0"></path> <path d="M10.5128 13.7916C9.67919 14.1002 8.90498 14.5396 8.22192 15.0918C7.44763 15.7332 6.79548 16.4987 6.29458 17.354C6.10521 17.6661 5.38897 18.9168 5.30161 20.9528C5.25223 22.1068 5.61361 23.2983 5.78561 23.7944C5.78543 23.7956 5.78543 23.7968 5.78561 23.798C5.89413 24.081 6.31791 25.0815 7.01191 25.9303C7.2135 26.1763 7.42963 26.4111 7.65924 26.6334C6.92357 26.1457 6.26746 25.5562 5.71236 24.8839C5.02433 24.0451 4.60001 23.0549 4.48932 22.7626C4.48919 22.7605 4.48919 22.7584 4.48932 22.7564V22.7527C4.31677 22.2571 3.95431 21.0651 4.00477 19.9096C4.09213 17.8736 4.80838 16.6239 4.99775 16.3108C5.4985 15.4553 6.15067 14.6898 6.92509 14.0486C7.608 13.4961 8.38225 13.0567 9.21598 12.7484C9.73602 12.5416 10.2778 12.3891 10.8319 12.2934C11.6669 12.1537 12.5198 12.1415 13.3588 12.2575V13.2196C12.3808 13.2349 11.4148 13.4291 10.5128 13.7916Z" fill="#69C9D0"></path> <path d="M20.5438 4.04635H17.2881V20.6159C17.2881 21.1983 17.2881 21.76 17.0863 22.3211C16.7575 23.2167 16.058 24.0253 15.1258 24.3842C13.7265 24.923 12.6326 24.8632 11.3276 24.0368C11.0036 23.823 10.7187 23.5594 10.4844 23.2567C11.5962 23.8251 12.5913 23.8152 13.8241 23.341C14.7558 22.9821 15.4563 22.1734 15.784 21.2774C15.9891 20.7178 15.9864 20.1546 15.9864 19.5726V3H20.4819C20.4819 3 20.4315 3.41188 20.5438 4.04635ZM26.7002 8.99104V9.9131C26.1725 9.79263 25.6609 9.61447 25.1755 9.38213C24.2352 8.93228 23.5026 8.19952 23.3594 8.0513C23.5256 8.1559 23.6981 8.25106 23.8759 8.33629C25.0192 8.88339 26.1451 9.04669 26.7002 8.99104Z" fill="#69C9D0"></path> </g></svg>
                    </a>

                    <!-- Telegram -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Join us on Telegram" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="16" cy="16" r="14" fill="url(#paint0_linear_87_7225)"></circle> <path d="M22.9866 10.2088C23.1112 9.40332 22.3454 8.76755 21.6292 9.082L7.36482 15.3448C6.85123 15.5703 6.8888 16.3483 7.42147 16.5179L10.3631 17.4547C10.9246 17.6335 11.5325 17.541 12.0228 17.2023L18.655 12.6203C18.855 12.4821 19.073 12.7665 18.9021 12.9426L14.1281 17.8646C13.665 18.3421 13.7569 19.1512 14.314 19.5005L19.659 22.8523C20.2585 23.2282 21.0297 22.8506 21.1418 22.1261L22.9866 10.2088Z" fill="white"></path> <defs> <linearGradient id="paint0_linear_87_7225" x1="16" y1="2" x2="16" y2="30" gradientUnits="userSpaceOnUse"> <stop stop-color="#37BBFE"></stop> <stop offset="1" stop-color="#007DBB"></stop> </linearGradient> </defs> </g></svg>
                    </a>
                    
                    <!-- WhatsApp (NEW) -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Connect with us on WhatsApp" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16 31C23.732 31 30 24.732 30 17C30 9.26801 23.732 3 16 3C8.26801 3 2 9.26801 2 17C2 19.5109 2.661 21.8674 3.81847 23.905L2 31L9.31486 29.3038C11.3014 30.3854 13.5789 31 16 31ZM16 28.8462C22.5425 28.8462 27.8462 23.5425 27.8462 17C27.8462 10.4576 22.5425 5.15385 16 5.15385C9.45755 5.15385 4.15385 10.4576 4.15385 17C4.15385 19.5261 4.9445 21.8675 6.29184 23.7902L5.23077 27.7692L9.27993 26.7569C11.1894 28.0746 13.5046 28.8462 16 28.8462Z" fill="#BFC8D0"></path> <path d="M28 16C28 22.6274 22.6274 28 16 28C13.4722 28 11.1269 27.2184 9.19266 25.8837L5.09091 26.9091L6.16576 22.8784C4.80092 20.9307 4 18.5589 4 16C4 9.37258 9.37258 4 16 4C22.6274 4 28 9.37258 28 16Z" fill="url(#paint0_linear_87_7264)"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M16 30C23.732 30 30 23.732 30 16C30 8.26801 23.732 2 16 2C8.26801 2 2 8.26801 2 16C2 18.5109 2.661 20.8674 3.81847 22.905L2 30L9.31486 28.3038C11.3014 29.3854 13.5789 30 16 30ZM16 27.8462C22.5425 27.8462 27.8462 22.5425 27.8462 16C27.8462 9.45755 22.5425 4.15385 16 4.15385C9.45755 4.15385 4.15385 9.45755 4.15385 16C4.15385 18.5261 4.9445 20.8675 6.29184 22.7902L5.23077 26.7692L9.27993 25.7569C11.1894 27.0746 13.5046 27.8462 16 27.8462Z" fill="white"></path> <path d="M12.5 9.49989C12.1672 8.83131 11.6565 8.8905 11.1407 8.8905C10.2188 8.8905 8.78125 9.99478 8.78125 12.05C8.78125 13.7343 9.52345 15.578 12.0244 18.3361C14.438 20.9979 17.6094 22.3748 20.2422 22.3279C22.875 22.2811 23.4167 20.0154 23.4167 19.2503C23.4167 18.9112 23.2062 18.742 23.0613 18.696C22.1641 18.2654 20.5093 17.4631 20.1328 17.3124C19.7563 17.1617 19.5597 17.3656 19.4375 17.4765C19.0961 17.8018 18.4193 18.7608 18.1875 18.9765C17.9558 19.1922 17.6103 19.083 17.4665 19.0015C16.9374 18.7892 15.5029 18.1511 14.3595 17.0426C12.9453 15.6718 12.8623 15.2001 12.5959 14.7803C12.3828 14.4444 12.5392 14.2384 12.6172 14.1483C12.9219 13.7968 13.3426 13.254 13.5313 12.9843C13.7199 12.7145 13.5702 12.305 13.4803 12.05C13.0938 10.953 12.7663 10.0347 12.5 9.49989Z" fill="white"></path> <defs> <linearGradient id="paint0_linear_87_7264" x1="26.5" y1="7" x2="4" y2="28" gradientUnits="userSpaceOnUse"> <stop stop-color="#5BD066"></stop> <stop offset="1" stop-color="#27B43E"></stop> </linearGradient> </defs> </g></svg>
                    </a>

                    <!-- Pinterest -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Follow us on Pinterest" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="24" cy="24" r="20" fill="#BD081C"></circle> <path fill-rule="evenodd" clip-rule="evenodd" d="M24.8523 12C18.3024 12 15 16.6959 15 20.6118C15 22.9826 15.8978 25.0924 17.8231 25.8777C18.1389 26.0067 18.4216 25.8822 18.5131 25.5327C18.5769 25.2905 18.7276 24.6799 18.7944 24.4257C18.8866 24.0799 18.8506 23.9592 18.5956 23.6577C18.0406 23.0029 17.6858 22.1553 17.6858 20.9546C17.6858 17.4699 20.2929 14.3513 24.4736 14.3513C28.1757 14.3513 30.2098 16.6141 30.2098 19.6345C30.2098 23.6096 28.4502 26.9645 25.8394 26.9645C24.3971 26.9645 23.3178 25.7712 23.6636 24.3087C24.0776 22.5626 24.8808 20.6771 24.8808 19.417C24.8808 18.289 24.2748 17.3477 23.0215 17.3477C21.547 17.3477 20.3627 18.8725 20.3627 20.9156C20.3627 22.2169 20.8022 23.0974 20.8022 23.0974C20.8022 23.0974 19.2931 29.4899 19.0291 30.6097C18.5026 32.8395 18.9504 35.5726 18.9879 35.8486C19.0104 36.0121 19.2204 36.0511 19.3156 35.9266C19.4514 35.7496 21.2072 33.5812 21.8042 31.4152C21.973 30.8024 22.774 27.6261 22.774 27.6261C23.2525 28.5396 24.6528 29.3444 26.1416 29.3444C30.5735 29.3444 33.5796 25.304 33.5796 19.8955C33.5796 15.8079 30.1168 12 24.8523 12Z" fill="white"></path> </g></svg>
                    </a>

                    <!-- YouTube -->
                    <a href="https://apie2c.github.io/recomproducts/#" target="_blank" aria-label="Subscribe to our YouTube channel" class="text-gray-400 hover:text-cyan-400 transition duration-150">
                        <svg width="27px" height="64px" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="24" cy="24" r="20" fill="#FF0000"></circle> <path fill-rule="evenodd" clip-rule="evenodd" d="M35.3005 16.3781C35.6996 16.7772 35.9872 17.2739 36.1346 17.8187C36.9835 21.2357 36.7873 26.6324 36.1511 30.1813C36.0037 30.7261 35.7161 31.2228 35.317 31.6219C34.9179 32.021 34.4212 32.3086 33.8764 32.456C31.8819 33 23.8544 33 23.8544 33C23.8544 33 15.8269 33 13.8324 32.456C13.2876 32.3086 12.7909 32.021 12.3918 31.6219C11.9927 31.2228 11.7051 30.7261 11.5577 30.1813C10.7038 26.7791 10.9379 21.3791 11.5412 17.8352C11.6886 17.2903 11.9762 16.7936 12.3753 16.3945C12.7744 15.9954 13.2711 15.7079 13.8159 15.5604C15.8104 15.0165 23.8379 15 23.8379 15C23.8379 15 31.8654 15 33.8599 15.544C34.4047 15.6914 34.9014 15.979 35.3005 16.3781ZM27.9423 24L21.283 27.8571V20.1428L27.9423 24Z" fill="white"></path> </g></svg>
                    </a>

                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript for Firebase, Data Management, and Routing -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL STATE & CONFIGURATION ---

        // Firebase variables provided by the canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Global Firebase instances
        let db = null;
        let auth = null;
        let userId = null;

        // Global App State (Holds all loaded product and category data)
        const appState = {
            products: [], // Flattened list of all products for easy search/lookup
            categories: {}, // Map of category data, used for grouping
            isDataLoaded: false
        };

        // Static Category Metadata
        const CATEGORY_METADATA = {
            'smart-home': { title: 'Smart Home & Automation', icon: 'ðŸ ', description: 'Explore devices that automate your living space, from security cameras to central hubs.' },
            'kitchen-tech': { title: 'Kitchen Appliances', icon: 'ðŸ³', description: 'The latest gadgets to simplify cooking, save time, and track nutrition easily.' },
            'personal-audio': { title: 'Personal Audio Gear', icon: 'ðŸŽ§', description: 'Immersive sound for music lovers, whether you are at home, working out, or traveling.' },
            'health-fitness': { title: 'Health & Fitness Tracking', icon: 'âŒš', description: 'Track your steps, sleep, and overall wellness with the newest wearables.' }
        };

        // Mock Product Data (Used for initial render and seeding Firestore)
        const MOCK_PRODUCTS = [
            { id: 'prod-coffee', categoryId: 'kitchen-tech', name: 'Wi-Fi Precision Brewer', price: '$199.99', reviews: 'â˜…â˜…â˜…â˜…â˜… (1,230 Reviews)', link: 'https://example.com/affiliate/coffee', image: 'https://placehold.co/600x400/2c3e50/ecf0f1?text=Wi-Fi+Brewer', description: 'Brew your perfect cup from bed! App-controlled temperature and strength settings. Compatible with Alexa and Google Home. This model features a thermal carafe and programmable brew cycles for maximum freshness and convenience.', featured: true },
            { id: 'prod-airpurifier', categoryId: 'smart-home', name: 'Aura Pro Air System', price: '$349.00', reviews: 'â˜…â˜…â˜…â˜…â˜† (895 Reviews)', link: 'https://example.com/affiliate/airpurifier', image: 'https://placehold.co/600x400/3498db/ffffff?text=Aura+Pro+Filter', description: 'HEPA filter technology cleans a 500 sq ft room in minutes. Whisper-quiet operation perfect for bedrooms and offices. Features an auto-sensor mode that adjusts power based on air quality.', featured: true },
            { id: 'prod-lighting', categoryId: 'smart-home', name: 'Prism Modular Light Panels', price: '$129.50', reviews: 'â˜…â˜…â˜…â˜…â˜… (4,510 Reviews)', link: 'https://example.com/affiliate/lighting', image: 'https://placehold.co/600x400/e74c3c/ffffff?text=Modular+Light+Panels', description: 'Customize your ambiance with 16 million colors. Easy-to-install, expand, and sync with your music and entertainment. Connect up to 30 panels on a single power supply.', featured: true },
            { id: 'prod-camera', categoryId: 'smart-home', name: 'Smart Security Camera', price: '$99.99', reviews: 'â˜…â˜…â˜…â˜…â˜† (500)', link: 'https://example.com/affiliate/camera', image: 'https://placehold.co/600x400/2c3e50/ecf0f1?text=Smart+Camera', description: '1080p HD video with night vision and two-way audio. Free 7-day cloud storage included. Great for indoor monitoring.' },
            { id: 'prod-smarthub', categoryId: 'smart-home', name: 'Universal Smart Hub', price: '$149.00', reviews: 'â˜…â˜…â˜…â˜…â˜… (1200)', link: 'https://example.com/affiliate/smarthub', image: 'https://placehold.co/600x400/1abc9c/ffffff?text=Smart+Hub', description: 'Centralized control for Z-Wave, Zigbee, and Wi-Fi devices. Voice control enabled via integrated microphone.' },
            { id: 'prod-doorbell', categoryId: 'smart-home', name: 'Wi-Fi Doorbell', price: '$179.99', reviews: 'â˜…â˜…â˜…â˜…â˜† (800)', link: 'https://example.com/affiliate/doorbell', image: 'https://placehold.co/600x400/f39c12/ffffff?text=Video+Doorbell', description: 'Instantly see and speak to visitors from anywhere. Motion detection alerts and seamless integration with smart locks.' },
            { id: 'prod-oven', categoryId: 'kitchen-tech', name: 'Smart Oven with Air Fryer', price: '$499.00', reviews: 'â˜…â˜…â˜…â˜…â˜… (2000)', link: 'https://example.com/affiliate/oven', image: 'https://placehold.co/600x400/e67e22/ffffff?text=Smart+Oven', description: 'Multi-function oven with integrated air frying mode. App control for pre-heating and recipe execution. Large 4.5 cubic foot capacity.' },
            { id: 'prod-scale', categoryId: 'kitchen-tech', name: 'Precision Food Scale', price: '$45.00', reviews: 'â˜…â˜…â˜…â˜…â˜† (300)', link: 'https://example.com/affiliate/scale', image: 'https://placehold.co/600x400/d35400/ffffff?text=Food+Scale', description: 'Accurate to 0.1 gram. Connects to nutrition tracking apps to log macros automatically.' },
            { id: 'prod-buds', categoryId: 'personal-audio', name: 'Noise Cancelling Buds', price: '$229.00', reviews: 'â˜…â˜…â˜…â˜…â˜… (4500)', link: 'https://example.com/affiliate/buds', image: 'https://placehold.co/600x400/34495e/ffffff?text=NC+Earbuds', description: 'Industry-leading active noise cancellation. 8 hours of battery life with case. IPX4 water resistance.' },
            { id: 'prod-speaker', categoryId: 'personal-audio', name: 'Portable Waterproof Speaker', price: '$79.99', reviews: 'â˜…â˜…â˜…â˜…â˜† (1500)', link: 'https://example.com/affiliate/speaker', image: 'https://placehold.co/600x400/9b59b6/ffffff?text=Portable+Speaker', description: 'Durable, fully submersible design (IP67 rated). 12-hour playtime and crystal clear audio quality.' },
            { id: 'prod-watch', categoryId: 'health-fitness', name: 'Fitness Smartwatch Gen 5', price: '$299.00', reviews: 'â˜…â˜…â˜…â˜…â˜… (6000)', link: 'https://example.com/affiliate/watch', image: 'https://placehold.co/600x400/2ecc71/ffffff?text=Fitness+Watch', description: 'All-day activity tracking, heart rate monitor, and built-in GPS. Up to 5 days of battery life.' },
            { id: 'prod-bodyscale', categoryId: 'health-fitness', name: 'Smart Body Composition Scale', price: '$59.00', reviews: 'â˜…â˜…â˜…â˜…â˜† (1000)', link: 'https://example.com/affiliate/bodyscale', image: 'https://placehold.co/600x400/16a085/ffffff?text=Smart+Scale', description: 'Measures weight, BMI, body fat, muscle mass, and water percentage. Syncs data automatically via Wi-Fi.' }
        ];

        // --- FIREBASE INITIALIZATION & DATA FETCHING ---

        // Helper to populate the app state with mock data for initial load/offline fallback
        function initializeMockState() {
            appState.products = MOCK_PRODUCTS;
            appState.categories = JSON.parse(JSON.stringify(CATEGORY_METADATA));
            MOCK_PRODUCTS.forEach(product => {
                const category = appState.categories[product.categoryId];
                if (category) {
                    if (!category.products) {
                         category.products = [];
                    }
                    category.products.push(product);
                }
            });
        }
        
        async function initializeFirebase() {
            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase configuration is missing. Using mock data only.");
                appState.isDataLoaded = true;
                router();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                await setPersistence(auth, browserSessionPersistence);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase Auth Ready. User ID:", userId);
                        fetchProductData();
                    } else {
                        console.error("User not signed in, fetching data anyway.");
                        fetchProductData();
                    }
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }

        // Seeds Firestore with the mock data if called manually
        window.seedInitialData = async function() {
            if (!db) {
                console.error("Firestore not initialized. Try again after the app loads.");
                return;
            }
            const productsCollectionRef = collection(db, `artifacts/${appId}/public/data/products`);
            console.log("Attempting to seed Firestore. Please ensure your security rules allow writes to this path.");

            try {
                for (const product of MOCK_PRODUCTS) {
                    // Use a simple addDoc here, allowing Firestore to auto-generate the ID
                    // NOTE: In a real app, you would use setDoc(doc(db, ...), product) to retain the ID
                    await addDoc(productsCollectionRef, product);
                }
                console.log(`Successfully added ${MOCK_PRODUCTS.length} mock products.`);
            } catch (error) {
                console.error("Error seeding data. Check your Firestore connection and security rules.", error);
            }
        }


        function fetchProductData() {
            if (!db) return;
            
            // Public data path: /artifacts/{appId}/public/data/products
            const productsCollectionRef = collection(db, `artifacts/${appId}/public/data/products`);
            
            // Set up real-time listener
            onSnapshot(productsCollectionRef, (snapshot) => {
                const tempProducts = [];
                // Reset categories using metadata to ensure all categories exist
                const tempCategories = JSON.parse(JSON.stringify(CATEGORY_METADATA)); 

                snapshot.forEach(doc => {
                    const product = { id: doc.id, ...doc.data() };
                    tempProducts.push(product);

                    // Group product into its category
                    const categoryId = product.categoryId;
                    if (tempCategories[categoryId]) {
                        if (!tempCategories[categoryId].products) {
                             tempCategories[categoryId].products = [];
                        }
                        tempCategories[categoryId].products.push(product);
                    }
                });

                // Overwrite state with live data
                appState.products = tempProducts;
                appState.categories = tempCategories;
                appState.isDataLoaded = true;
                console.log("Product data updated from Firestore. Total products:", appState.products.length);
                
                // Trigger UI re-render
                router(); 
            }, (error) => {
                console.error("Error fetching product data:", error);
                // If Firestore listener fails, ensure routing happens with mock data
                appState.isDataLoaded = true; 
                router();
            });
        }

        // --- UTILITIES & HELPERS ---

        function getProductById(productId) {
            return appState.products.find(p => p.id === productId);
        }
        
        // Universal Product Card Renderer (Used by Home, Category, Search)
        function createProductCard(product) {
            // Use product.id for the detail link
            return `
                <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden transform hover:scale-[1.02] transition duration-300 border border-gray-700 cursor-pointer" onclick="window.location.hash = 'product-${product.id}'">
                    <img src="${product.image}" onerror="this.onerror=null; this.src='https://placehold.co/600x400/1e293b/ffffff?text=${product.name.replace(/\s/g, '+')}';" alt="${product.name}" class="w-full h-48 object-cover object-center">
                    <div class="p-6">
                        <h3 class="text-xl font-semibold text-cyan-400 mb-2">${product.name}</h3>
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-2xl font-bold text-white">${product.price}</span>
                            <span class="text-sm text-yellow-400 font-medium">${product.reviews}</span>
                        </div>
                        <!-- Affiliate Link CTA -->
                        <a href="${product.link}" target="_blank" class="w-full block text-center py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-500 transition duration-150 shadow-md" onclick="event.stopPropagation();">
                            View Deal
                        </a>
                    </div>
                </div>
            `;
        }

        // --- VIEW RENDERING FUNCTIONS (UPDATED) ---

        function renderHomePage() {
            const featuredProductsContainer = document.querySelector('#featured .grid');
            
            // Show up to the first 3 products marked as featured
            const featuredProducts = appState.products.filter(p => p.featured).slice(0, 3);
            if (featuredProducts.length === 0) {
                 featuredProductsContainer.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No featured products found.</div>';
            } else {
                featuredProductsContainer.innerHTML = featuredProducts.map(createProductCard).join('');
            }
            
            // Update category links 
            const categoriesContainer = document.querySelector('#categories .grid');
            categoriesContainer.innerHTML = Object.keys(appState.categories).map(key => {
                const data = appState.categories[key];
                return `
                    <a href="#category-${key}" class="p-6 bg-gray-800 rounded-xl text-center hover:bg-gray-700 transition duration-200 border-t border-gray-700 shadow-lg">
                        <span class="text-5xl mb-3 block" role="img" aria-label="${data.title}">${data.icon}</span>
                        <h3 class="text-lg font-semibold text-white">${data.title}</h3>
                        <p class="text-sm text-gray-400">${data.products ? data.products.length : 0} Products</p>
                    </a>
                `;
            }).join('');
        }

        function renderCategoryPage(categoryId) {
            const data = appState.categories[categoryId];
            const categoryPage = document.getElementById('category-page');
            const productGrid = document.getElementById('category-product-grid');
            const categoryTitle = document.getElementById('category-title');
            const categoryDesc = document.getElementById('category-description');
            const breadcrumbCategory = document.getElementById('breadcrumb-category');

            if (!data) {
                categoryPage.innerHTML = '<div class="text-center py-20 text-gray-500">Sorry, this category is temporarily unavailable or does not exist.</div>';
                return;
            }

            categoryTitle.innerHTML = `${data.icon} ${data.title}`;
            categoryDesc.textContent = data.description;
            breadcrumbCategory.textContent = data.title;

            productGrid.innerHTML = data.products && data.products.length > 0
                ? data.products.map(createProductCard).join('')
                : '<div class="col-span-full text-center py-8 text-gray-500">No products found in this category.</div>';
        }
        
        function renderProductDetailPage(productId) {
            const product = getProductById(productId);
            const detailPage = document.getElementById('product-detail-page');
            
            if (!product) {
                detailPage.innerHTML = `
                    <div class="text-center py-20 text-gray-500">
                        <p class="text-2xl font-bold mb-4">Product Not Found</p>
                        <p>The product ID "${productId}" could not be located.</p>
                        <a href="#" class="inline-block mt-6 px-6 py-2 bg-cyan-600 text-white rounded-full hover:bg-cyan-500 transition">Go Back Home</a>
                    </div>`;
                return;
            }

            const category = appState.categories[product.categoryId] || { title: 'Products', icon: 'ðŸ“¦' };

            detailPage.innerHTML = `
                <!-- Breadcrumbs -->
                <div class="text-sm breadcrumbs mb-8 text-gray-500">
                    <a href="#" class="hover:text-cyan-400 transition duration-150">Home</a> 
                    <span class="mx-2">&gt;</span> 
                    <a href="#category-${product.categoryId}" class="hover:text-cyan-400 transition duration-150">${category.icon} ${category.title}</a>
                    <span class="mx-2">&gt;</span> 
                    <span class="text-cyan-400 font-semibold">${product.name}</span>
                </div>

                <div class="bg-gray-800 rounded-2xl p-6 md:p-12 shadow-2xl border border-gray-700 flex flex-col lg:flex-row gap-8">
                    
                    <!-- Product Image -->
                    <div class="lg:w-1/2 flex-shrink-0">
                        <img src="${product.image}" onerror="this.onerror=null; this.src='https://placehold.co/800x600/1e293b/ffffff?text=${product.name.replace(/\s/g, '+')}';" alt="${product.name}" class="w-full h-96 object-cover rounded-xl shadow-lg border border-gray-700">
                    </div>
                    
                    <!-- Product Details -->
                    <div class="lg:w-1/2 space-y-6">
                        <h1 class="text-4xl font-extrabold text-cyan-400">${product.name}</h1>
                        <p class="text-3xl font-bold text-white">${product.price}</p>
                        
                        <!-- Ratings -->
                        <div class="flex items-center space-x-2">
                            <span class="text-xl text-yellow-400 font-medium">${product.reviews}</span>
                            <span class="text-gray-400">| ${product.reviews.match(/\((\d+)/)?.[1] || '0'} Total Ratings</span>
                        </div>

                        <p class="text-gray-300 leading-relaxed">${product.description || 'No detailed description provided for this product. See the deal link for more information.'}</p>
                        
                        <!-- CTA Button -->
                        <a href="${product.link}" target="_blank" class="mt-8 w-full inline-block text-center py-4 bg-cyan-400 text-gray-900 text-xl font-bold rounded-xl hover:bg-cyan-300 transition duration-150 shadow-xl transform hover:scale-[1.01]">
                            <span class="inline-block mr-2">ðŸ›’</span> View Latest Deal on Partner Site
                        </a>
                    </div>
                </div>
            `;
        }

        function renderSearchResultsPage(query) {
            const searchInput = document.getElementById('search-input');
            searchInput.value = query;

            const productGrid = document.getElementById('search-product-grid');
            const noResultsMessage = document.getElementById('no-results');
            const searchQueryDisplay = document.getElementById('search-query-display');
            
            searchQueryDisplay.textContent = query;
            
            const lowerCaseQuery = query.toLowerCase();
            
            // Simple filter search across name and description
            const results = appState.products.filter(product => 
                product.name.toLowerCase().includes(lowerCaseQuery) || 
                (product.description && product.description.toLowerCase().includes(lowerCaseQuery))
            );

            if (results.length > 0) {
                productGrid.innerHTML = results.map(createProductCard).join('');
                productGrid.classList.remove('hidden');
                noResultsMessage.classList.add('hidden');
            } else {
                productGrid.innerHTML = '';
                productGrid.classList.add('hidden');
                noResultsMessage.classList.remove('hidden');
            }
        }


        // --- ROUTING LOGIC (UPDATED to handle 4 views) ---
        function router() {
            // Only proceed if data is loaded (either mock or live)
            if (!appState.isDataLoaded) return; 

            const hash = window.location.hash.substring(1); 
            const homePage = document.getElementById('home-page');
            const categoryPage = document.getElementById('category-page');
            const productDetailPage = document.getElementById('product-detail-page');
            const searchResultsPage = document.getElementById('search-results-page');

            // Hide all views first
            homePage.classList.add('hidden');
            categoryPage.classList.add('hidden');
            productDetailPage.classList.add('hidden');
            searchResultsPage.classList.add('hidden');
            
            window.scrollTo(0, 0);

            if (hash.startsWith('category-')) {
                const categoryId = hash.replace('category-', '');
                categoryPage.classList.remove('hidden');
                renderCategoryPage(categoryId);

            } else if (hash.startsWith('product-')) {
                const productId = hash.replace('product-', '');
                productDetailPage.classList.remove('hidden');
                renderProductDetailPage(productId);
                
            } else if (hash.startsWith('search')) {
                const urlParams = new URLSearchParams(hash.substring(hash.indexOf('?') + 1));
                const query = urlParams.get('q') || '';
                searchResultsPage.classList.remove('hidden');
                renderSearchResultsPage(query);

            } else {
                // Default to Home Page
                homePage.classList.remove('hidden');
                renderHomePage(); 
            }
            
            // Close mobile menu
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.add('hidden');
            }
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Initialize Mock Data first, so the page isn't blank
            initializeMockState();
            
            // 2. Initialize Firebase and start listening for real data
            initializeFirebase();
            
            // 3. Mobile Menu Toggle
            const menuButton = document.getElementById('menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            menuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // 4. Search Input Handler (Enter Key)
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && searchInput.value.trim() !== '') {
                    // Navigate to the search results page
                    window.location.hash = `search?q=${encodeURIComponent(searchInput.value.trim())}`;
                }
            });

            // 5. Initial route and hash change listener
            // Router is called initially when isDataLoaded becomes true inside fetchProductData/initializeFirebase
            window.addEventListener('hashchange', router);

            // Initial route rendering using mock data (will be replaced by live data)
            router();
        });
    </script>
</body>
</html>
